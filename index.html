<!DOCTYPE html>
<html>
<head>
    <title>WGL</title>
    <meta charset="utf-8">

    <style>
        * { padding: 0; margin: 0; box-sizing: border-box; }

        body { background-color: #000; }

        #renderer {
            width: 100%; height: 100%;
            position: absolute; top: 0px; bottom: 0px; left: 0px; right: 0px;
            border: 10px solid yellow;
            border-radius: 20px;
            background-color: #FFF;
        }
    </style>
</head>
<body>
    <canvas id="renderer"></canvas>

    <script src="gl-matrix.js"></script>
    <script src="dx.js"></script>
    <script>

        // init
        const renderer = document.getElementById("renderer");
        const dx = DX(renderer.getContext("webgl2"));

        // viewport

        const projectionMatrix = mat4.create();

        window.onresize = function () {
            renderer.setAttribute("width", renderer.clientWidth);
            renderer.setAttribute("height", renderer.clientHeight);

            dx.gl.viewport(0, 0, renderer.clientWidth, renderer.clientHeight);

            const fieldOfView = 45 * Math.PI / 180;   // in radians
            const aspect = renderer.clientWidth / renderer.clientHeight;
            const zNear = 0.1;
            const zFar = 100.0;
            mat4.perspective(projectionMatrix, fieldOfView, aspect, zNear, zFar);
        }

        window.onresize();

        // shape

        const cl0 = ["y","r","g"];
        const cl1 = ["y","g","b"];

        var s = 1.0;

        var shape0 = dx.GradedShape(
            [
                [-s, -s,  s], [ s, -s,  s], [ s,  s,  s], [-s,  s,  s],
                [-s, -s, -s], [ s, -s, -s], [ s,  s, -s], [-s,  s, -s],
            ],
            {
                "y": [1.0,  1.0,  0.0,  1.0],    // yellow
                "r": [1.0,  0.0,  0.0,  1.0],    // red
                "g": [0.0,  1.0,  0.0,  1.0],    // green
                "b": [0.0,  0.0,  1.0,  1.0],    // blue
            },
            [
                //[0, 1, 2, "g"], [0, 2, 3, "g"],    // front
                [4, 5, 6, ...cl0], [4, 6, 7, ...cl1],    // back
                [0, 1, 5, ...cl0], [0, 5, 4, ...cl1],    // bottom
                [3, 2, 6, ...cl0], [3, 6, 7, ...cl1],    // top
                [0, 4, 7, ...cl0], [0, 7, 3, ...cl1],    // left
                [1, 2, 6, ...cl0], [1, 6, 5, ...cl1],    // right
            ]
        );

        var s = 1.5;

        var shape1 = dx.GradedShape(
            [
                [-s, -s,  s], [ s, -s,  s], [ s,  s,  s], [-s,  s,  s],
                [-s, -s, -s], [ s, -s, -s], [ s,  s, -s], [-s,  s, -s],
            ],
            {
                "y": [1.0,  1.0,  0.0,  1.0],    // yellow
                "r": [1.0,  0.0,  0.0,  1.0],    // red
                "g": [0.0,  1.0,  0.0,  1.0],    // green
                "b": [0.0,  0.0,  1.0,  1.0],    // blue
            },
            [
                //[0, 1, 2, "g"], [0, 2, 3, "g"],    // front
                [4, 5, 6, ...cl0], [4, 6, 7, ...cl1],    // back
                [0, 1, 5, ...cl0], [0, 5, 4, ...cl1],    // bottom
                [3, 2, 6, ...cl0], [3, 6, 7, ...cl1],    // top
                [0, 4, 7, ...cl0], [0, 7, 3, ...cl1],    // left
                [1, 2, 6, ...cl0], [1, 6, 5, ...cl1],    // right
            ]
        );


        var modelViewMatrix = mat4.create();
        var normalMatrix = mat4.create();


        // drawing

        var then = 0;
        var cubeRotation = 0.0;

        function render(now) {
            now *= 0.001;  // convert to seconds
            const deltaTime = now - then;
            then = now;

            mat4.translate(modelViewMatrix, mat4.create(), [-0.0, 0.0, -10.0]);  // amount to translate

            cubeRotation += deltaTime;
            mat4.rotate(modelViewMatrix, modelViewMatrix, cubeRotation, [0, 0, 1]);
            mat4.rotate(modelViewMatrix, modelViewMatrix, 0.7 * cubeRotation, [0, 1, 0]);

            /*mat4.invert(normalMatrix, modelViewMatrix);
            mat4.transpose(normalMatrix, normalMatrix);*/

            dx.clear();
            dx.draw(shape0, modelViewMatrix, projectionMatrix);
            dx.draw(shape1, modelViewMatrix, projectionMatrix);

            requestAnimationFrame(render);
        }

        requestAnimationFrame(render);


    </script>
</body>
</html>